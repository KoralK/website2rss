name: RSS to Blogger Workflow

on:
  push:
    branches:
      - main

jobs:
  generate-post:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Save Google Application Credentials
        run: echo "${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}" > secret.json

      - name: Verify secret.json content
        run: cat secret.json
        shell: bash

      - name: Generate RSS JSON
        run: python website2rss.py

      - name: Verify RSS JSON
        if: success()
        run: if [ ! -f bundle_rss.json ]; then echo "Error: bundle_rss.json not found." && exit 1; fi

      - name: Generate HTML
        env:
          GEMMINI_FLASH_API_KEY: ${{ secrets.GEMMINI_FLASH_API_KEY }}
        run: python generate_dynamic_html.py

      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: smart-home-news
          path: smart_home_news.html
          if-no-files-found: warn

      - name: Post to Blogger
        env:
          GOOGLE_APPLICATION_CREDENTIALS: secret.json
        run: python post_to_blogger.py
